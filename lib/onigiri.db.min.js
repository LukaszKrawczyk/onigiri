(function(){var global=function(){return this}.call();global.onigiri=function(e){},onigiri.db=function(params){this.set=function(e){return this.name=e,this},this.save=function(e,t){if(!this.name)return console.error("Please set name of database"),!1;var n=this.storage.length;for(var r in t)"id"in t[r]||(t[r].id=n),this.storage.setItem(this.__encodeKey(e,t[r].id),this.__encodeObject(t[r])),n++;return!0},this.remove=function(e,t){var n=this.__encodeKey(e,t);this.storage.removeItem(n)},this.find=function(e,t){var n=[];for(var r=0;r<this.storage.length;r++){var i=this.storage.key(r);if(i.indexOf(this.__encodeTableKey(e))>=0){var s=this.findById(e,i.split(".")[2]),o,u;o=u=0;for(var a in t)o++,t[a]==s[a]&&u++;(u===o||o===0)&&n.push(s)}}return n.reverse()},this.findById=function(e,t){var n=this.__encodeKey(e,t);return this.__decodeObject(t,this.storage.getItem(n))},this.__encodeKey=function(e,t){return this.name+"."+e+"."+t},this.__decodeKey=function(e){var t=e.split(".");return{db:t[0],table:t[1],id:t[2]}},this.__encodeObject=function(e){return JSON.stringify(e)},this.__decodeObject=function(id,string){return eval("var obj = "+string),obj},this.__encodeTableKey=function(e){return this.name+"."+e+"."},this.clear=function(){var e=this.storage.length,t=0;for(var n=0;n<e;n++){var r=this.storage.key(t);r.indexOf(this.name)>=0?this.storage.removeItem(r):t++}return this},this.__construct=function(e,t){e.storage=window.localStorage,t&&(e.name=t.name?t.name:null,e.onUpdate=t.onUpdate?t.onUpdate:function(e){}),window.addEventListener("storage",e.onUpdate,!1)}(this,params)}})();