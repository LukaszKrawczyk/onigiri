(function(){(function(){return this}).call().onigiri=function(){};onigiri.db=function(d){this.set=function(a){this.name=a;return this};this.save=function(a,b){if(!this.name)return console.error("Please set name of database"),!1;index=this.storage.length;for(i in b)"id"in b[i]||(b[i].id=index),this.storage.setItem(this.__encodeKey(a,b[i].id),this.__encodeObject(b[i])),index++;return!0};this.remove=function(a,b){key=this.__encodeKey(a,b);this.storage.removeItem(key)};this.find=function(a,b){result= [];for(i=0;i<this.storage.length;i++)if(key=this.storage.key(i),0<=key.indexOf(this.__encodeTableKey(a))){obj=this.findById(a,key.split(".")[2]);totalConditions=foundConditions=0;for(c in b)totalConditions++,b[c]==obj[c]&&foundConditions++;(foundConditions==totalConditions||0==totalConditions)&&result.push(obj)}return result.reverse()};this.findById=function(a,b){key=this.__encodeKey(a,b);return this.__decodeObject(b,this.storage.getItem(key))};this.__encodeKey=function(a,b){return this.name+"."+ a+"."+b};this.__encodeObject=function(a){return JSON.stringify(a)};this.__decodeObject=function(a,b){eval("var obj = "+b);return obj};this.__encodeTableKey=function(a){return this.name+"."+a+"."};this.clear=function(){length=this.storage.length;for(i=pointer=0;i<length;i++)key=this.storage.key(pointer),0<=key.indexOf(this.name)?this.storage.removeItem(key):pointer++;return this};console.log(d);this.storage=window.localStorage;d&&(this.name=d.db?d.db:null,this.onUpdate=d.db?d.onUpdate:function(){}); window.addEventListener("storage",this.onUpdate,!1);this.init=void 0}})();